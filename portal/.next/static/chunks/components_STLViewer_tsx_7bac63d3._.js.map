{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/vedatcanduzgezen/Desktop/lumera-dental-website/portal/components/STLViewer.tsx"],"sourcesContent":["// components/STLViewer.tsx\n\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport * as THREE from \"three\";\n\nexport default function STLViewer({ url }: { url: string }) {\n  const ref = useRef<HTMLDivElement | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!ref.current || !url) return;\n\n    let cancelled = false;\n    setError(null);\n\n    const container = ref.current;\n    const width = container.clientWidth || 400;\n    const height = container.clientHeight || 320;\n\n    const scene = new THREE.Scene();\n    scene.background = new THREE.Color(0x000000);\n\n    const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);\n    camera.position.set(0, 0, 200);\n\n    const renderer = new THREE.WebGLRenderer({ antialias: true });\n    renderer.setSize(width, height);\n    renderer.setPixelRatio(window.devicePixelRatio || 1);\n\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n    container.appendChild(renderer.domElement);\n\n    const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 0.9);\n    scene.add(hemi);\n\n    const dir = new THREE.DirectionalLight(0xffffff, 0.7);\n    dir.position.set(5, 10, 7.5);\n    scene.add(dir);\n\n    const group = new THREE.Group();\n    scene.add(group);\n\n    let controls: any;\n    let raf = 0;\n\n    async function setupControls() {\n      const mod = await import(\n        \"three/examples/jsm/controls/OrbitControls.js\"\n      );\n      const OrbitControls = mod.OrbitControls;\n      controls = new OrbitControls(camera, renderer.domElement);\n      controls.enableDamping = true;\n    }\n\n    const frameObject = (obj: THREE.Object3D) => {\n      const box = new THREE.Box3().setFromObject(obj);\n      const size = new THREE.Vector3();\n      const center = new THREE.Vector3();\n      box.getSize(size);\n      box.getCenter(center);\n\n      obj.position.sub(center);\n\n      const maxDim = Math.max(size.x, size.y, size.z) || 1;\n      const fov = (camera.fov * Math.PI) / 180;\n      let cameraZ = maxDim / (2 * Math.tan(fov / 2));\n      cameraZ *= 1.6;\n\n      camera.position.set(0, 0, cameraZ);\n      camera.lookAt(0, 0, 0);\n      controls?.target.set(0, 0, 0);\n      controls?.update();\n    };\n\n    const addGeometry = (geometry: THREE.BufferGeometry) => {\n      geometry.computeVertexNormals?.();\n      const material = new THREE.MeshStandardMaterial({\n        color: 0xffffff,\n        metalness: 0.1,\n        roughness: 0.8,\n      });\n      const mesh = new THREE.Mesh(geometry, material);\n      group.add(mesh);\n      frameObject(mesh);\n    };\n\n    const onLoadError = (err: any) => {\n      if (cancelled) return;\n      console.error(\"3D model load failed:\", err);\n      setError(\"Could not load this 3D file.\");\n    };\n\n    async function loadModel() {\n      // âœ… Only strip query params, NOT '#'\n      let cleanUrl = url.toLowerCase();\n      const qIndex = cleanUrl.indexOf(\"?\");\n      if (qIndex >= 0) {\n        cleanUrl = cleanUrl.slice(0, qIndex);\n      }\n\n      try {\n        if (cleanUrl.endsWith(\".stl\")) {\n          const mod = await import(\n            \"three/examples/jsm/loaders/STLLoader.js\"\n          );\n          const STLLoader = mod.STLLoader;\n          const loader = new STLLoader();\n          loader.load(\n            url,\n            (geometry: any) => {\n              if (cancelled) return;\n              addGeometry(geometry as THREE.BufferGeometry);\n            },\n            undefined,\n            onLoadError,\n          );\n        } else if (cleanUrl.endsWith(\".ply\")) {\n          const mod = await import(\n            \"three/examples/jsm/loaders/PLYLoader.js\"\n          );\n          const PLYLoader = mod.PLYLoader;\n          const loader = new PLYLoader();\n          loader.load(\n            url,\n            (geometry: any) => {\n              if (cancelled) return;\n              addGeometry(geometry as THREE.BufferGeometry);\n            },\n            undefined,\n            onLoadError,\n          );\n        } else if (cleanUrl.endsWith(\".obj\")) {\n          const mod = await import(\n            \"three/examples/jsm/loaders/OBJLoader.js\"\n          );\n          const OBJLoader = mod.OBJLoader;\n          const loader = new OBJLoader();\n          loader.load(\n            url,\n            (object: THREE.Object3D) => {\n              if (cancelled) return;\n              group.add(object);\n              frameObject(object);\n            },\n            undefined,\n            onLoadError,\n          );\n        } else {\n          console.warn(\"Unsupported 3D file type:\", url);\n          setError(\"This file type is not supported for 3D preview.\");\n        }\n      } catch (e) {\n        onLoadError(e);\n      }\n    }\n\n    setupControls()\n      .then(loadModel)\n      .catch((err) => onLoadError(err));\n\n    const animate = () => {\n      if (cancelled) return;\n      raf = requestAnimationFrame(animate);\n      controls?.update();\n      renderer.render(scene, camera);\n    };\n    animate();\n\n    const onResize = () => {\n      const w = container.clientWidth || width;\n      const h = container.clientHeight || height;\n      camera.aspect = w / h;\n      camera.updateProjectionMatrix();\n      renderer.setSize(w, h);\n    };\n    window.addEventListener(\"resize\", onResize);\n\n    return () => {\n      cancelled = true;\n      cancelAnimationFrame(raf);\n      window.removeEventListener(\"resize\", onResize);\n      renderer.dispose();\n      scene.clear();\n      while (container.firstChild) {\n        container.removeChild(container.firstChild);\n      }\n    };\n  }, [url]);\n\n  return (\n    <div className=\"relative w-full h-full\">\n      <div ref={ref} className=\"w-full h-full\" />\n      {error && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-black/60\">\n          <p className=\"text-xs text-red-300 px-3 text-center\">\n            {error}\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}