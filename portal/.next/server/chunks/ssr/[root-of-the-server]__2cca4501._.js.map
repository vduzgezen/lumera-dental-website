{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///Users/vedatcanduzgezen/Desktop/lumera-dental-website/portal/lib/prisma.ts"],"sourcesContent":["// portal/lib/prisma.ts\nimport { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"query\", \"error\", \"warn\"], // Helpful logs for dev\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}"],"names":[],"mappings":"AAAA,uBAAuB;;;;;AACvB;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;QAAS;KAAO;AACjC;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/vedatcanduzgezen/Desktop/lumera-dental-website/portal/lib/auth.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport jwt from \"jsonwebtoken\";\n\nexport type Session = {\n  userId: string;\n  role: \"customer\" | \"lab\" | \"admin\";\n  clinicId?: string;\n};\n\nconst COOKIE = \"lumera_session\";\nconst SECRET = process.env.JWT_SECRET!;\n\n/**\n * Read & verify the session JWT from the request cookies.\n * Next.js 15: cookies() can be async, so we await it.\n */\nexport async function getSession(): Promise<Session | null> {\n  const jar = await cookies(); // async in Next 15\n  const token = jar.get(COOKIE)?.value;\n  if (!token) return null;\n  try {\n    return jwt.verify(token, SECRET) as Session;\n  } catch {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQA,MAAM,SAAS;AACf,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;AAM9B,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,0IAAO,KAAI,mBAAmB;IAChD,MAAM,QAAQ,IAAI,GAAG,CAAC,SAAS;IAC/B,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI;QACF,OAAO,gJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///Users/vedatcanduzgezen/Desktop/lumera-dental-website/portal/app/portal/cases/page.tsx"],"sourcesContent":["// portal/app/portal/cases/page.tsx\nimport { prisma } from \"@/lib/prisma\";\nimport { getSession } from \"@/lib/auth\";\nimport Link from \"next/link\";\nimport { notFound } from \"next/navigation\";\nimport { Prisma } from \"@prisma/client\";\n\nexport const dynamic = \"force-dynamic\";\n\n// Use inferred types from Prisma to stay safe\ntype CaseRow = {\n  id: string;\n  patientAlias: string;\n  toothCodes: string;\n  status: string;\n  dueDate: Date | null;\n  updatedAt: Date;\n  doctorName: string | null;\n  clinic: { name: string };\n};\n\nfunction fmtDate(d?: Date | null) {\n  if (!d) return \"‚Äî\";\n  return new Date(d).toLocaleDateString();\n}\n\nexport default async function CasesPage({\n  searchParams,\n}: {\n  searchParams: Promise<Record<string, string | string[] | undefined>>;\n}) {\n  const session = await getSession();\n  if (!session) return notFound();\n\n  const sp = await searchParams;\n\n  const getParam = (key: string): string | undefined => {\n    const value = sp[key];\n    if (Array.isArray(value)) return value[0];\n    if (typeof value === \"string\") return value;\n    return undefined;\n  };\n\n  const role = session.role;\n  const canCreate = role === \"lab\" || role === \"admin\";\n  const isDoctor = role === \"customer\";\n\n  const clinicFilter = getParam(\"clinic\");\n  const doctorFilter = getParam(\"doctor\");\n  const caseIdFilter = getParam(\"caseId\");\n  const dateFilter = getParam(\"date\");\n  const aliasFilter = getParam(\"alias\"); // for doctors\n\n  const where: Prisma.DentalCaseWhereInput = {};\n\n  if (isDoctor) {\n    // STRICT: doctors see only their own cases\n    where.doctorUserId = session.userId ?? \"__none__\";\n\n    if (aliasFilter && aliasFilter.trim()) {\n      const q = aliasFilter.trim();\n      where.OR = [\n        { patientAlias: { contains: q } },\n        { toothCodes: { contains: q } },\n      ];\n    }\n  } else {\n    // Lab/Admin: advanced filters\n    if (clinicFilter && clinicFilter.trim()) {\n      where.clinic = {\n        name: { contains: clinicFilter.trim() },\n      };\n    }\n\n    if (doctorFilter && doctorFilter.trim()) {\n      where.doctorName = {\n        contains: doctorFilter.trim(),\n      };\n    }\n\n    if (caseIdFilter && caseIdFilter.trim()) {\n      where.id = {\n        contains: caseIdFilter.trim(),\n      };\n    }\n\n    if (dateFilter && dateFilter.trim()) {\n      const d = new Date(dateFilter);\n      if (!Number.isNaN(d.getTime())) {\n        const start = new Date(d);\n        start.setHours(0, 0, 0, 0);\n        const end = new Date(start);\n        end.setDate(end.getDate() + 1);\n        where.dueDate = { gte: start, lt: end };\n      }\n    }\n  }\n\n  // DIRECT FIX: Use prisma.dentalCase directly\n  const rows = (await prisma.dentalCase.findMany({\n    where,\n    orderBy: [{ updatedAt: \"desc\" }],\n    take: 50,\n    select: {\n      id: true,\n      patientAlias: true,\n      toothCodes: true,\n      status: true,\n      dueDate: true,\n      updatedAt: true,\n      doctorName: true,\n      clinic: { select: { name: true } },\n    },\n  })) as CaseRow[];\n\n  return (\n    <section>\n      <header className=\"flex items-center justify-between mb-4\">\n        <h1 className=\"text-2xl font-semibold\">Cases</h1>\n        {canCreate && (\n          <Link\n            href=\"/portal/cases/new\"\n            className=\"px-3 py-1.5 rounded-lg bg-white text-black text-sm\"\n          >\n            + New Case\n          </Link>\n        )}\n      </header>\n\n      {/* üîç Search Bar */}\n      <form className=\"mb-4 flex flex-wrap gap-2 items-center\">\n        {canCreate && (\n          <>\n            <input\n              name=\"clinic\"\n              placeholder=\"Clinic\"\n              defaultValue={clinicFilter ?? \"\"}\n              className=\"bg-black/30 border border-white/10 rounded-lg px-2 py-1 text-sm text-white\"\n            />\n            <input\n              name=\"doctor\"\n              placeholder=\"Doctor\"\n              defaultValue={doctorFilter ?? \"\"}\n              className=\"bg-black/30 border border-white/10 rounded-lg px-2 py-1 text-sm text-white\"\n            />\n            <input\n              name=\"caseId\"\n              placeholder=\"Case ID\"\n              defaultValue={caseIdFilter ?? \"\"}\n              className=\"bg-black/30 border border-white/10 rounded-lg px-2 py-1 text-sm text-white\"\n            />\n            <div className=\"flex items-center gap-1\">\n              <label className=\"text-xs text-white/60\">Due date</label>\n              <input\n                type=\"date\"\n                name=\"date\"\n                defaultValue={dateFilter ?? \"\"}\n                className=\"bg-black/30 border border-white/10 rounded-lg px-2 py-1 text-sm text-white\"\n              />\n            </div>\n            <button\n              type=\"submit\"\n              className=\"bg-white text-black rounded-lg px-3 py-1 text-sm\"\n            >\n              Search\n            </button>\n            <Link\n              href=\"/portal/cases\"\n              className=\"bg-transparent border border-white/20 text-white rounded-lg px-3 py-1 text-sm\"\n            >\n              Clear\n            </Link>\n          </>\n        )}\n\n        {isDoctor && (\n          <>\n            <input\n              name=\"alias\"\n              placeholder=\"Search by alias or tooth\"\n              defaultValue={aliasFilter ?? \"\"}\n              className=\"bg-black/30 border border-white/10 rounded-lg px-2 py-1 text-sm text-white flex-1\"\n            />\n            <button\n              type=\"submit\"\n              className=\"bg-white text-black rounded-lg px-3 py-1 text-sm\"\n            >\n              Search\n            </button>\n            <Link\n              href=\"/portal/cases\"\n              className=\"bg-transparent border border-white/20 text-white rounded-lg px-3 py-1 text-sm\"\n            >\n              Clear\n            </Link>\n          </>\n        )}\n      </form>\n\n      <div className=\"rounded-xl border border-white/10 overflow-hidden\">\n        <table className=\"w-full text-sm\">\n          <thead className=\"bg-white/5 text-white/80\">\n            <tr>\n              <th className=\"text-left p-3\">Case ID</th>\n              <th className=\"text-left p-3\">Alias</th>\n              <th className=\"text-left p-3\">Clinic</th>\n              <th className=\"text-left p-3\">Doctor</th>\n              <th className=\"text-left p-3\">Tooth</th>\n              <th className=\"text-left p-3\">Status</th>\n              <th className=\"text-left p-3\">Due</th>\n              <th className=\"text-left p-3\">Updated</th>\n            </tr>\n          </thead>\n          <tbody>\n            {rows.map((c: CaseRow) => (\n              <tr\n                key={c.id}\n                className=\"border-t border-white/10 hover:bg-white/5 transition\"\n              >\n                <td className=\"p-3\">\n                  <code className=\"text-xs\">{c.id}</code>\n                </td>\n                <td className=\"p-3\">\n                  <Link href={`/portal/cases/${c.id}`} className=\"underline\">\n                    {c.patientAlias}\n                  </Link>\n                </td>\n                <td className=\"p-3\">{c.clinic.name}</td>\n                <td className=\"p-3\">{c.doctorName ?? \"‚Äî\"}</td>\n                <td className=\"p-3\">{c.toothCodes}</td>\n                <td className=\"p-3\">{c.status}</td>\n                <td className=\"p-3\">{fmtDate(c.dueDate)}</td>\n                <td className=\"p-3\">{fmtDate(c.updatedAt)}</td>\n              </tr>\n            ))}\n            {rows.length === 0 && (\n              <tr>\n                <td className=\"p-3 text-white/60\" colSpan={8}>\n                  No cases found.\n                </td>\n              </tr>\n            )}\n          </tbody>\n        </table>\n      </div>\n    </section>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}