{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///Users/vedatcanduzgezen/Desktop/lumera-dental-website/portal/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst g = global as unknown as { prisma?: PrismaClient };\nexport const prisma = g.prisma ?? new PrismaClient();\nif (process.env.NODE_ENV !== \"production\") g.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACC,MAAM,SAAS,EAAE,MAAM,IAAI,IAAI,6IAAY;AAClD,wCAA2C,EAAE,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/vedatcanduzgezen/Desktop/lumera-dental-website/portal/lib/auth.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport jwt from \"jsonwebtoken\";\n\nexport type Session = {\n  userId: string;\n  role: \"customer\" | \"lab\" | \"admin\";\n  clinicId?: string;\n};\n\nconst COOKIE = \"lumera_session\";\nconst SECRET = process.env.JWT_SECRET!;\n\n/**\n * Read & verify the session JWT from the request cookies.\n * Next.js 15: cookies() can be async, so we await it.\n */\nexport async function getSession(): Promise<Session | null> {\n  const jar = await cookies(); // async in Next 15\n  const token = jar.get(COOKIE)?.value;\n  if (!token) return null;\n  try {\n    return jwt.verify(token, SECRET) as Session;\n  } catch {\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQA,MAAM,SAAS;AACf,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;AAM9B,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,0IAAO,KAAI,mBAAmB;IAChD,MAAM,QAAQ,IAAI,GAAG,CAAC,SAAS;IAC/B,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI;QACF,OAAO,gJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/vedatcanduzgezen/Desktop/lumera-dental-website/portal/components/CaseActions.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/CaseActions.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/CaseActions.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA8R,GAC3T,4DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///Users/vedatcanduzgezen/Desktop/lumera-dental-website/portal/components/CaseActions.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/CaseActions.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/CaseActions.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA0Q,GACvS,wCACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/vedatcanduzgezen/Desktop/lumera-dental-website/portal/app/portal/cases/%5Bid%5D/page.tsx"],"sourcesContent":["// app/portal/cases/[id]/page.tsx\nimport { prisma } from \"@/lib/prisma\";\nimport { getSession } from \"@/lib/auth\";\nimport { notFound } from \"next/navigation\";\nimport CaseActions from \"@/components/CaseActions\";\nimport FileUploader from \"@/components/FileUploader\";\nimport STLViewer from \"@/components/STLViewer\";\n\nexport const dynamic = \"force-dynamic\";\n\nfunction fmtDate(d?: Date | null) {\n  if (!d) return \"—\";\n  return new Date(d).toLocaleString();\n}\n\n/** Picks the correct model getter no matter how Prisma named it */\nfunction getCaseModel(): any {\n  const client: any = prisma as any;\n  return client.dentalCase ?? client.case ?? client.case_;\n}\n\ntype Params = Promise<{ id: string }>;\n\nexport default async function CaseDetailPage({\n  params,\n}: {\n  params: Params;\n}) {\n  const session = await getSession();\n  if (!session) return notFound();\n\n  // Next.js 15: params is async\n  const { id } = await params;\n  if (!id) return notFound();\n\n  const model = getCaseModel();\n\n  const item = await model.findUnique({\n    where: { id },\n    include: {\n      clinic: true,\n      files: { orderBy: { createdAt: \"asc\" } },\n      events: { orderBy: { at: \"asc\" } },\n    },\n  });\n\n  if (!item) return notFound();\n\n  // Doctors can only view THEIR cases. Prefer doctorUserId, fall back to clinicId for legacy rows.\n  if (session.role === \"customer\") {\n    const isOwner = item.doctorUserId\n      ? session.userId && item.doctorUserId === session.userId\n      : session.clinicId && item.clinicId === session.clinicId;\n\n    if (!isOwner) return notFound();\n  }\n\n  const byLabel = (label: string) =>\n    item.files.filter((f: any) => f.label === label);\n\n  const scanFiles = byLabel(\"SCAN\");\n  const modelPlusDesignFiles = byLabel(\"MODEL_PLUS_DESIGN\");\n  const designOnlyFiles = byLabel(\"DESIGN_ONLY\");\n\n  return (\n    <section className=\"space-y-6\">\n      <header>\n        <h1 className=\"text-2xl font-semibold\">{item.patientAlias}</h1>\n        <p className=\"text-white/70\">\n          Clinic: {item.clinic.name} • Teeth: {item.toothCodes} • Status: {item.status}\n        </p>\n        <p className=\"text-white/50\">Due: {fmtDate(item.dueDate)}</p>\n      </header>\n\n      <div className=\"grid md:grid-cols-3 gap-4\">\n        <div className=\"rounded-xl border border-white/10 p-4\">\n          <h2 className=\"font-medium mb-2\">Scan (STL/PLY/OBJ)</h2>\n          {scanFiles.length === 0 ? (\n            <p className=\"text-white/60\">No scan uploaded yet.</p>\n          ) : (\n            <ul className=\"list-disc list-inside text-white/80\">\n              {scanFiles.map((f: any) => (\n                <li key={f.id}>\n                  <a className=\"underline\" href={f.url} target=\"_blank\">\n                    {f.url.split(\"/\").pop()}\n                  </a>\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n\n        <div className=\"rounded-xl border border-white/10 p-4\">\n          <h2 className=\"font-medium mb-2\">Model + Design (STL)</h2>\n          {modelPlusDesignFiles.length === 0 ? (\n            <p className=\"text-white/60\">Not uploaded yet.</p>\n          ) : (\n            <ul className=\"list-disc list-inside text-white/80\">\n              {modelPlusDesignFiles.map((f: any) => (\n                <li key={f.id}>\n                  <a className=\"underline\" href={f.url} target=\"_blank\">\n                    {f.url.split(\"/\").pop()}\n                  </a>\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n\n        <div className=\"rounded-xl border border-white/10 p-4\">\n          <h2 className=\"font-medium mb-2\">Design Only (STL)</h2>\n          {designOnlyFiles.length === 0 ? (\n            <p className=\"text-white/60\">Not uploaded yet.</p>\n          ) : (\n            <ul className=\"list-disc list-inside text-white/80\">\n              {designOnlyFiles.map((f: any) => (\n                <li key={f.id}>\n                  <a className=\"underline\" href={f.url} target=\"_blank\">\n                    {f.url.split(\"/\").pop()}\n                  </a>\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n      </div>\n\n      <div className=\"rounded-xl border border-white/10 p-4\">\n        <h2 className=\"font-medium mb-2\">Actions</h2>\n        <CaseActions\n          caseId={item.id}\n          role={session.role as any}\n          currentStatus={item.status as any}\n        />\n      </div>\n    </section>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}